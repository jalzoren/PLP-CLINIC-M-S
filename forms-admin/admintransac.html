<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daily Transaction / PLP Clinic Monitoring System</title>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/transstyle.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link rel="icon" type="image/png" href="../pictures/logo.png" />
  </head>
  <body>
    <div class="sidebar">
      <div class="logo-content">
        <div class="logo" id="logo">
          <img src="../pictures/logo.png" alt="Logo" class="logo-img" />
          <div class="logo-name">PLPClinic</div>
        </div>
      </div>

      <ul class="nav-list">
        <li>
          <a href="admindashboard.html" class="transition-link">
            <i class="material-icons">dashboard</i>
            <span class="link-name">Dashboard</span>
          </a>
          <span class="tooltip">Dashboard</span>
        </li>

        <li>
          <a href="medrecords.html" class="transition-link">
            <i class="material-icons">folder_shared</i>
            <span class="link-name">Records</span>
          </a>
          <span class="tooltip">Patient Records</span>
        </li>
        <li>
          <a href="borrowing.html" class="transition-link">
            <i class="material-icons">dns</i>
            <span class="link-name">Borrow</span>
          </a>
          <span class="tooltip">Borrowing Records</span>
        </li>

        <li>
          <a href="userborrow.html" class="transition-link">
            <i class="material-icons">assignment</i>
            <span class="link-name">Borrow</span>
          </a>
          <span class="tooltip">Borrow Form</span>
        </li>

            <li>
                <a href="admintransac.html" class="active">
                    <i class="material-icons">perm_contact_calendar</i>
                    <span class="link-name">Transactions</span>
                </a>
                <span class="tooltip">Visit Records</span>
            </li>
            <li>
                <a href="adminiteminv.html" class="transition-link">
                    <i class="material-icons">storage</i>
                    <span class="link-name">Inventory</span>
                </a>
                <span class="tooltip">Item Inventory</span>
            </li>
        </ul>
        <ul>
            <li class="log-out">
                <br />
                <br />
                <br />
                <br />
                
                <a href="../php/logout.php">
                    <i class="material-icons">exit_to_app</i>
                    <span class="link-name">Logout</span>
                </a>
            </li>
        </ul>
    </div>

    <div class="header-content">
        <div class="text">VISIT RECORDS</div>
    </div>

    <div class="home-content">
      <div class="controls">
        <div class="search-container">
          <input type="text" id="searchInput" placeholder="Search..." />
          <button class="search-btn" onclick="searchTable()">
            <i class="fa fa-search"></i>
          </button>
        </div>
        <select id="daysFilter" onchange="fetchData()">
          <option value="7">Last 7 Days</option>
          <option value="30">Last 30 Days</option>
          <option value="90">Last 90 Days</option>
          <option value="365">Last 365 Days</option>
        </select>
        <button class="control-button" onclick="sortTable()">
          <i class="bx bx-sort-alt-2"></i>
        </button>
      </div>

      <div class="container">
        <h3>Daily Visit Records</h3>
        <table>
         <thead>
  <tr>
    <th>No.</th>
    <th>Date</th>
    <th>Time In</th>
    <th>Time Out</th>
    <th>Full Name</th>
    <th>Category</th>
    <th>Department/Course Yr. & Sec.</th>
    <th>Reason</th>
    <th>Medication</th>
    <th>Qty.</th>
    <th>Remarks</th>
  </tr>
</thead>

          <tbody id="visitTableBody">
            <!-- Data will be populated here -->
          </tbody>
        </table>
      </div>
    </div>

   <script>
  let btn = document.querySelector("#logo");
  let sidebar = document.querySelector(".sidebar");

  btn.onclick = function () {
    sidebar.classList.toggle("active");
  };

  function fetchData() {
    const days = document.getElementById('daysFilter').value;
    fetch(`../php/fetch_visits.php?days=${days}`)
      .then(response => response.json())
      .then(data => {
        if (data.status === 'success') {
          populateVisitTable(data.data.details);
        } else {
          console.error('Error fetching data:', data.message);
          document.getElementById('visitTableBody').innerHTML = '<tr><td colspan="11">Error loading data</td></tr>';
        }
      })
      .catch(error => {
        console.error('Fetch error:', error);
        document.getElementById('visitTableBody').innerHTML = '<tr><td colspan="11">Error loading data</td></tr>';
      });
  }

  function populateVisitTable(data) {
    const tbody = document.getElementById('visitTableBody');
    tbody.innerHTML = ''; // Clear previous content

    if (data.length === 0) {
      tbody.innerHTML = '<tr><td colspan="11">No records found</td></tr>';
      return;
    }

    data.forEach((row, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${row.date || ''}</td>
        <td>${row.time_in || ''}</td>
        <td>${row.time_out || ''}</td>
        <td>${row.full_name || ''}</td>
        <td>${row.category || ''}</td>
        <td>${row.department || ''}</td>
        <td>${row.reason || ''}</td>
        <td>${row.medication || ''}</td>
        <td>${row.quantity || 0}</td>
        <td>${row.remarks || ''}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function searchTable() {
    const input = document.getElementById('searchInput').value.toLowerCase();
    const rows = document.querySelectorAll('#visitTableBody tr');
    rows.forEach(row => {
      const cells = row.querySelectorAll('td');
      const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');
      row.style.display = rowText.includes(input) ? '' : 'none';
    });
  }

  let sortDirection = 1;
  function sortTable() {
    const tbody = document.getElementById('visitTableBody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    rows.sort((a, b) => {
      const aDate = a.cells[1].textContent.trim();
      const bDate = b.cells[1].textContent.trim();
      return sortDirection * aDate.localeCompare(bDate);
    });
    sortDirection *= -1;
    tbody.innerHTML = '';
    rows.forEach(row => tbody.appendChild(row));
  }

  // Load data on page load
  fetchData();
</script>

  </body>
</html>