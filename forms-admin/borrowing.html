<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Borrowing Forms / PLP Clinic Monitoring System</title>
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/borrowstyle.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link rel="icon" type="image/png" href="../pictures/logo.png">

  </head>
  <body>
    <div class="sidebar">
      <div class="logo-content">
        <div class="logo" id="logo">
          <img src="../pictures/logo.png" alt="Logo" class="logo-img" />
          <div class="logo-name">PLPClinic</div>
        </div>
      </div>

      <ul class="nav-list">
        <li>
          <a
            href="admindashboard.html"
            class="transition-link"
          >
            <i class="bx bxs-grid-alt bx-rotate-180"></i>
            <span class="link-name">Dashboard</span>
          </a>
          <span class="tooltip">Dashboard</span>
        </li>

        <li>
            <a href="medrecords.html" class="transition-link">
            <i class='bx bxs-file' ></i>               
            <span class="link-name">Records</span>
          </a>
          <span class="tooltip">Patient Records</span>
        </li>
        <li>
          <a href="borrowing.html" class="active">
          <i class='bx bxs-cabinet'></i>
          <span class="link-name">Borrow</span>
          </a>
          <span class="tooltip">Borrowing Records</span>
        </li>
        
        <li>
            <a href="userborrow.html" class="transition-link">
            <i class="bx bxs-file-plus"></i>
            <span class="link-name">Borrow</span>
            </a>
            <span class="tooltip">Borrow Form</span>
        </li>

        <li>
          <a href="admintransac.html" class="transition-link">
            <i class="bx bxs-info-square"></i>
            <span class="link-name">Transactions</span>
          </a>
          <span class="tooltip">Daily Transaction</span>
        </li>
        <li>
          <a href="adminiteminv.html" class="transition-link">
            <i class="bx bxs-book-content"></i>
            <span class="link-name">Inventory</span>
          </a>
          <span class="tooltip">Item Inventory</span>
        </li>
      </ul>
      <ul>
        <li class="log-out">
          <br />
          <br />
          <br />
          <br /> 
          <br />
        
     

          <a href="#">
            <i class="bx bx-log-out bx-rotate-180"></i>
            <span class="link-name">Logout</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="header-content">
      <div class="text">
        BORROWED ITEM RECORDS
      </div>
    </div>

    <div class="home-content">

      <!--
      <div class="status-container">
        <aside class="status-box">
          <p><strong>STATUS</strong></p>
          <ul>
            <li>Borrowed</li>
            <li>Returned</li>
            <li>Overdue</li>
            <li>Lost</li>
            <li>Damage (Returned)</li>
          </ul>
        </aside>
      </div>
      -->

      <div class="controls-container">
        
        <div class="controls">
          <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search..." />
            <button class="search-btn" onclick="searchTable()">
              <i class="fa fa-search"></i> 
            </button>
          </div>
          <button class="control-button" onclick="filterTable()">
              <i class='bx bx-filter'></i>
          </button>
          <button class="control-button" onclick="sortTable()">
              <i class='bx bx-sort-alt-2' ></i>
          </button>


        </div>
      </div>

      <div class="container">
        <table id="borrowedItemsTable">
          <thead>
            <tr>
              <th>No.</th>
              <th>Identification Number</th>
              <th>Full Name</th>
              <th>Category</th>
              <th>Department/Course Yr. & Sec.</th>
              <th>Date Borrowed</th>
              <th>Date Returned</th>
              <th>Borrowed Item<br />(specify)</th>
              <th>Qty.</th>
              <th>Status</th>
              <th>Photo<br />(Borrowed)</th>
              <th>Photo<br />(Returned)</th>
            </tr>
          </thead>
          <tbody id="borrowedItemsBody">
            <!-- Records will be dynamically inserted here -->
          </tbody>
        </table>
      </div>
       <div class="pagination">
        <button class="page-btn" onclick="goToPage('prev')">&laquo;</button>
        <span id="pagination-numbers"></span>
        <button class="page-btn" onclick="goToPage('next')">&raquo;</button>
      </div>
    </div>

    <script>
      let btn = document.querySelector("#logo");
      let sidebar = document.querySelector(".sidebar");

      btn.onclick = function () {
        sidebar.classList.toggle("active");
      };

      // Variables for pagination
      let currentPage = 1;
      const recordsPerPage = 10;
      let allRecords = [];

      // Fetch records from the server
      async function fetchRecords() {
        try {
          const response = await fetch('../php/borrowing_records.php');
          const data = await response.json();
          allRecords = data;
          displayRecords();
          setupPagination();
        } catch (error) {
          console.error('Error fetching records:', error);
        }
      }

      // Display records for the current page
      function displayRecords() {
        const tbody = document.getElementById('borrowedItemsBody');
        tbody.innerHTML = '';
        
        const start = (currentPage - 1) * recordsPerPage;
        const end = start + recordsPerPage;
        const paginatedRecords = allRecords.slice(start, end);

        paginatedRecords.forEach((record, index) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${start + index + 1}</td>
            <td>${record.ID_Number}</td>
            <td>${record.FullName}</td>
            <td>${record.Category}</td>
            <td>${record.DepartmentInfo}</td>
            <td>${formatDate(record.Date_Borrowed)}</td>
            <td>${record.Date_Returned ? formatDate(record.Date_Returned) : '-'}</td>
            <td>${record.Item_Name}</td>
            <td>${record.Quantity}</td>
            <td>${record.Status}</td>
            <td>${record.Photo_Borrowed ? `<img src="${record.Photo_Borrowed}" width="60" alt="Borrowed"/>` : '-'}</td>
            <td>${record.Photo_Returned ? `<img src="${record.Photo_Returned}" width="60" alt="Returned"/>` : '-'}</td>
          `;
          tbody.appendChild(row);
        });
      }

      // Setup pagination
      function setupPagination() {
        const totalPages = Math.ceil(allRecords.length / recordsPerPage);
        const paginationNumbers = document.getElementById('pagination-numbers');
        paginationNumbers.innerHTML = '';

        for (let i = 1; i <= totalPages; i++) {
          const button = document.createElement('button');
          button.className = `page-btn ${currentPage === i ? 'active' : ''}`;
          button.textContent = i;
          button.onclick = () => goToPage(i);
          paginationNumbers.appendChild(button);
        }
      }

      // Navigate between pages
      function goToPage(page) {
        if (page === 'prev') {
          if (currentPage > 1) currentPage--;
        } else if (page === 'next') {
          if (currentPage < Math.ceil(allRecords.length / recordsPerPage)) currentPage++;
        } else {
          currentPage = page;
        }
        displayRecords();
        setupPagination();
      }

      // Search functionality
      function searchTable() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const filteredRecords = allRecords.filter(record => 
          record.FullName.toLowerCase().includes(searchTerm) ||
          record.Item_Name.toLowerCase().includes(searchTerm) ||
          record.Status.toLowerCase().includes(searchTerm) ||
          record.ID_Number.toLowerCase().includes(searchTerm) ||
          record.DepartmentInfo.toLowerCase().includes(searchTerm)
        );
        
        currentPage = 1;
        allRecords = filteredRecords;
        displayRecords();
        setupPagination();
      }

      // Format date
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      }

      // Load records when page loads
      document.addEventListener('DOMContentLoaded', fetchRecords);
    </script>

    <script>

      
  // Get URL params
  const params = new URLSearchParams(window.location.search);
  const role = params.get("role"); // 'admin' or 'staff'

  document.getElementById("dashboardBtn").addEventListener("click", function() {
    if (role === "staff") {
      window.location.href = "staff-dashboard.html";
    } else {
      window.location.href = "admin-dashboard.html";
    }
  });
    </script>
  </body>
</html>
